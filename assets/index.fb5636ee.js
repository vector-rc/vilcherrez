import{d as N,u as V,c as B,a as f,b as l,e as A,w,f as Q,g as M,h as e,r as ne,o as g,I as W,B as me,S as de,i as ce,j as _e,P as ue,k as Ce,l as u,m as z,n as v,v as I,p as Pe,A as ge,F as G,q as K,t as y,E as Se,s as $,x as Z,y as J,z as X,C as ee,D as se,G as ae,H as fe,J as Ee,K as Re,L as Ae,M as De,N as Oe,O as Ue}from"./vendor.49dc3b86.js";const he=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const t of s.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&r(t)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};he();const ve={class:"is-fluid columns p-5"},Ie={key:0,class:"column is-1"},be=e("span",null,"Productos",-1),ye=e("span",null,"Ventas",-1),Te=e("span",null,"Configs",-1),Le=e("span",null,"Barcodes",-1),Me=e("span",null,"Usuarios",-1),we={class:"column is-11"},Fe=N({setup(d){const a=V(),n=B(()=>a.state.user.userName),r=B(()=>a.state.isAuthenticated);return(o,s)=>{const t=ne("router-link"),c=ne("router-view");return g(),f("main",ve,[l(r)?(g(),f("div",Ie,[A(t,{class:"item_menu",to:"/products"},{default:w(()=>[A(l(W),{size:"30"},{default:w(()=>[A(l(me))]),_:1}),be]),_:1}),A(t,{class:"item_menu",to:"/sales"},{default:w(()=>[A(l(W),{size:"30"},{default:w(()=>[A(l(de))]),_:1}),ye]),_:1}),A(t,{class:"item_menu",to:"/printers"},{default:w(()=>[A(l(W),{size:"30"},{default:w(()=>[A(l(ce))]),_:1}),Te]),_:1}),A(t,{class:"item_menu",to:"/barcodes"},{default:w(()=>[A(l(W),{size:"30"},{default:w(()=>[A(l(_e))]),_:1}),Le]),_:1}),l(n)==="Balta"?(g(),Q(t,{key:0,class:"button is-link",to:"/signup"},{default:w(()=>[A(l(W),{size:"30"},{default:w(()=>[A(l(ue))]),_:1}),Me]),_:1})):M("",!0)])):M("",!0),e("div",we,[A(c)])])}}});var oe=Ce({state:{products:[],user:{},isAuthenticated:!1},mutations:{test(){console.log("hola desde vuex")}},actions:{async fetchProducts({state:d}){try{const n=await(await fetch("http://3.136.228.138/shop-back/api/v1/products")).json();return n.success&&(d.products=n.data.reverse()),n}catch(a){return console.log(a.type),{success:!0,message:a}}},async fetchPackProducts({state:d},{id:a}){try{return await(await fetch(`http://3.136.228.138/shop-back/api/v1/pack_product/${a}`,{headers:{Authorization:`bearer ${d.user.token} `}})).json()}catch(n){return{data:null,success:!0,message:n}}},async fetchRoles(){try{return await(await fetch("http://3.136.228.138/shop-back/api/v1/user_roles")).json()}catch(d){return{success:!0,message:d}}},async userLogin({state:d},{credentials:a}){try{const r=await(await fetch("http://3.136.228.138/shop-back/api/v1/login",{method:"POST",body:JSON.stringify(a)})).json();return console.log(r),r.success&&(d.user=r.data,d.isAuthenticated=r.success,localStorage.token=r.data.token),r}catch(n){return console.log(n),{success:!1,message:n}}},async userSignup({state:d},{user:a}){try{return await(await fetch("http://3.136.228.138/shop-back/api/v1/signup",{method:"POST",body:JSON.stringify(a)})).json()}catch(n){return console.log(n),{success:!1,message:n}}},async saveProduct({state:d},{action:a,product:n}){try{const o=await(await fetch("http://3.136.228.138/shop-back/api/v1/product",{method:a==="add"?"POST":"PUT",headers:{Authorization:`bearer ${d.user.token} `},body:JSON.stringify(n)})).json();if(o.success&&(a==="add"&&d.products.unshift(o.data),a==="edit")){const s=d.products.findIndex(t=>t.id===n.id);console.log(s),d.products[s]=o.data}return o}catch{}},async savePackingProduct({state:d},{action:a,data:n}){console.log({action:a});try{return await(await fetch("http://3.136.228.138/shop-back/api/v1/product",{method:a==="add"?"POST":"PUT",headers:{Authorization:`bearer ${d.user.token} `},body:JSON.stringify(n)})).json()}catch{}},async printerTicket(d,{text:a}){return await(await fetch(`http://localhost:5050/printer/${localStorage.printer}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,qr_content:"hola mundo"})})).text()},async testEncode(d,{text:a}){return await(await fetch("http://localhost:5050/decodeurl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,qr_content:"hola mundo"})})).text()},async getInfoDoc({state:d},{typeDoc:a,document:n}){let r;return console.log(a),a===1&&(r=await fetch(`http://3.136.228.138/shop-back/api/v1/dni/${n}`,{headers:{Authorization:`bearer ${d.user.token} `}})),a===6&&(r=await fetch(`http://3.136.228.138/shop-back/api/v1/ruc/${n}`,{headers:{Authorization:`bearer ${d.user.token} `}})),(await r.json()).data},async saveSale({state:d},{soldProducts:a,client:n,typeProof:r}){return(await(await fetch("http://3.136.228.138/shop-back/api/v1/sale",{method:"POST",headers:{Authorization:`bearer ${d.user.token} `},body:JSON.stringify({soldProducts:a,client:n,userId:d.user.id,typeProof:r})})).json()).data}},modules:{}});const Ne={class:"columns"},ke={class:"column is-11"},xe={class:"control has-icons-left"},We={class:"column is-1"},Ve={class:"h-100 oy-scroll"},Ge={class:"table is-narrow is-hoverable is-bordered is-striped is-fullwidth"},$e=e("thead",null,[e("tr",{style:{position:"sticky"}},[e("th",null,"Codigo"),e("th",null,"Nombre"),e("th",null,"Precio"),e("th",null,"Cantidad"),e("th")])],-1),je={style:{"padding-top":"2px"}},He=["onClick"],Be=["onClick"],Ke=N({emits:["editProduct"],setup(d,{emit:a}){const n=V(),r=u([]),o=u([]),s=u("");z(async()=>{r.value=n.state.products,o.value=n.state.products});const t=()=>{const P=s.value.toLowerCase().split(" "),m=[];P.forEach((C,h)=>{if(C.length<2)return;r.value.filter(({name:R,code:j})=>R.toLowerCase().includes(C)||j.toString().toLowerCase().includes(C)).forEach((R,j)=>{if(m.length===0){m.push(R);return}if(m.every(({id:x})=>x!==R.id))m.push(R);else{const x=m.findIndex(({id:q})=>q===R.id);m.splice(x,1),m.unshift(R)}})}),o.value=m},c=S=>{console.log("hola")},E=S=>{navigator.clipboard.writeText(S.name)},i=async()=>{await n.dispatch("fetchProducts"),r.value=n.state.products,o.value=n.state.products};return(S,P)=>(g(),f(G,null,[e("div",Ne,[e("div",ke,[e("div",xe,[v(e("input",{class:"input",type:"search",onInput:P[0]||(P[0]=m=>t()),"onUpdate:modelValue":P[1]||(P[1]=m=>s.value=m),placeholder:"Buscar producto"},null,544),[[I,s.value,void 0,{trim:!0}]]),A(l(W),{class:"icon is-large is-left"},{default:w(()=>[A(l(Pe))]),_:1})])]),e("div",We,[e("button",{class:"button is-primary",onClick:P[2]||(P[2]=m=>i())},[A(l(W),{class:"icon is-large is-left"},{default:w(()=>[A(l(ge))]),_:1})])])]),e("div",Ve,[e("table",Ge,[$e,e("tbody",je,[(g(!0),f(G,null,K(o.value,m=>(g(),f("tr",{key:m.id},[e("td",null,y(m.code),1),e("td",{style:{cursor:"copy"},onClick:C=>E(m)},y(m.name),9,He),e("td",null,"S/."+y(m.priceSale),1),e("td",null,y(m.stock),1),e("td",null,[e("button",{class:"button is-info is-small",onClick:C=>(c(),a("editProduct",m.productId))},[A(l(W),null,{default:w(()=>[A(l(Se))]),_:1})],8,Be)])]))),128))])])])],64))}}),Je={class:"control"},Xe={key:0,class:"help is-danger"},qe=["disabled","value"],ze={class:"control"},Ze={class:"control"},Ye={class:"control"},Qe={class:"control"},es={class:"control"},ss=e("i",{class:"bi bi-trash"},null,-1),os=[ss],ns=N({props:{product:Object},emits:["quit"],setup(d,{emit:a}){const n=d,r=V(),o=$(n.product),s=u(!1),t=u(!1),c=u(),E=()=>{if(o.priceBuy===0)return;let m=0;switch(o.packing.toLocaleUpperCase()){case"UND":m=.5;break;case"10 UND":m=.25;break;case"12 UND":m=.25;break;case"100 UND":m=.15;break}if(m!==0){const C=o.priceBuy+o.priceBuy*m;o.packing==="UND"?o.priceSale=Math.round((C+Number.EPSILON)*10)/10:o.priceSale=Math.ceil(C)}},i=()=>{const m=o.code;setTimeout(()=>{o.code===m&&c.value.blur()},100)};o.productId;const S=()=>(o.productId!==void 0?t.value=r.state.products.some(({code:m,productId:C})=>m.toString()===o.code&&C!==o.productId):t.value=r.state.products.some(({code:m})=>m.toString()===o.code),s.value=!1,t.value),P=()=>{o.code="",t.value=!1,c.value.focus()};return(m,C)=>(g(),f("tr",null,[e("td",Je,[v(e("input",{autocomplete:"off",onInput:C[0]||(C[0]=h=>i()),style:{position:"absolute","pointer-events":"none",opacity:"0"},onClick:C[1]||(C[1]=h=>h.target.blur()),onBlur:C[2]||(C[2]=h=>S()),onFocus:C[3]||(C[3]=h=>s.value=!0),ref_key:"codeField",ref:c,"onUpdate:modelValue":C[4]||(C[4]=h=>l(o).code=h)},null,544),[[I,l(o).code]]),t.value?(g(),f("span",Xe,"Ya hay un producto con este codigo")):M("",!0),Z(" "+y(l(o).code)+" ",1),e("input",{type:"button",onClick:C[5]||(C[5]=h=>P()),disabled:s.value,value:s.value?"Esperando escaneo...":"Escanear codigo",class:"button is-info"},null,8,qe)]),e("td",ze,[v(e("input",{class:"input is-upper",placeholder:"10UND","onUpdate:modelValue":C[6]||(C[6]=h=>l(o).packing=h)},null,512),[[I,l(o).packing]])]),e("td",Ze,[v(e("input",{class:"input is-upper",type:"number",step:"0.01",placeholder:"precio de compra","onUpdate:modelValue":C[7]||(C[7]=h=>l(o).priceBuy=h),onInput:C[8]||(C[8]=h=>E())},null,544),[[I,l(o).priceBuy]])]),e("td",Ye,[v(e("input",{class:"input is-upper",type:"number",step:"0.01",placeholder:"Precio de Venta","onUpdate:modelValue":C[9]||(C[9]=h=>l(o).priceSale=h)},null,512),[[I,l(o).priceSale]])]),e("td",Qe,[v(e("input",{class:"input is-upper",type:"number",placeholder:"Cantidad","onUpdate:modelValue":C[10]||(C[10]=h=>l(o).stock=h)},null,512),[[I,l(o).stock]])]),e("td",es,[e("button",{type:"button",class:"button is-danger",onClick:C[11]||(C[11]=h=>a("quit",n.product.id))},os)])]))}}),as={key:0,class:"modal is-active"},rs=e("div",{class:"modal-background"},null,-1),ts={class:"modal-card"},is={class:"modal-card-head"},ls=e("p",{class:"modal-card-title"},"Advertencia",-1),ps=e("section",{class:"modal-card-body"},"Algunos codigos estan vacios, \xBFquiere guardar de todas formas?",-1),ms={class:"modal-card-foot"},ds={class:"field"},cs={class:"control"},_s={key:0,class:"help is-danger"},us={class:"table is-bordered"},Cs=e("th",null,"CODIGO",-1),Ps=e("th",null,"PACKING",-1),gs=e("th",null,"PRECIO DE COMPRA",-1),Ss=e("th",null,"PRECIO DE VENTA",-1),fs=e("th",null,"CANTIDAD",-1),Es=e("button",{class:"button is-primary"},"Guardar producto",-1),Rs={key:1,class:"notification is-success"},As=e("button",{class:"delete"},null,-1),Ds=Z(" Producto guardado con exito "),Os=[As,Ds],Us=N({props:{productId:{type:Number,default:-1}},emits:["cancelEdit"],setup(d,{emit:a}){const n=d,r=V(),o=u(),s=u(!1),t=u(),c=u(!1),E=u(!1),i=$({id:0,name:"",brand:"",tags:"",description:"",features:{},image:""}),S=u([]),P=u([{id:"V"+Date.now()+1,code:"",packing:"UND",measureUnit:"NIU",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+2,code:"",packing:"12 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+3,code:"",packing:"100 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0}]),m=()=>{P.value=[{id:"V"+Date.now()+1,code:"",packing:"UND",measureUnit:"NIU",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+2,code:"",packing:"12 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+3,code:"",packing:"100 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0}],i.name="",i.brand="",i.tags="",i.features={},i.description="",i.image="",a("cancelEdit")};J(async()=>{if(n.productId!==-1){const L=await r.dispatch("fetchPackProducts",{id:n.productId});P.value=L.data.packedProducts,i.name=L.data.product.name,i.id=L.data.product.id}else m()});const C=()=>{P.value.push({id:"V"+Date.now(),code:"",packing:"",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0})},h=L=>{if(P.value.length===1)return;const U=P.value.findIndex(T=>T.id===L);P.value.splice(U,1)},D=()=>(n.productId!==-1?s.value=r.state.products.some(({name:L,productId:U})=>L.toLowerCase()===i.name.toLowerCase()&&U!==i.id):s.value=r.state.products.some(({name:L})=>L.toLowerCase()===i.name.toLowerCase()),s.value),R=async()=>{if(s.value)return;E.value=!1;const L={action:n.productId!==-1?"edit":"add",data:{product:i,packedProducts:[...P.value]}};(await r.dispatch("savePackingProduct",L)).success&&(m(),x())},j=()=>{o.value.select()},x=()=>{c.value=!0,setTimeout(()=>{c.value=!1},2e3)},q=async()=>{const L={action:n.productId!==-1?"edit":"add",data:{product:i,packedProducts:[...P.value]}};if(D())return;if(P.value.some(T=>T.code==="")){E.value=!0;return}(await r.dispatch("savePackingProduct",L)).success&&(m(),x())};return(L,U)=>(g(),f(G,null,[E.value?(g(),f("div",as,[rs,e("div",ts,[e("header",is,[ls,e("button",{class:"delete","aria-label":"close",onClick:U[0]||(U[0]=T=>E.value=!1)})]),ps,e("footer",ms,[e("button",{onClick:U[1]||(U[1]=T=>R()),class:"button is-success"},"Guradar"),e("button",{onClick:U[2]||(U[2]=T=>E.value=!1),class:"button"},"Cancelar")])])])):M("",!0),e("form",{onSubmit:U[9]||(U[9]=ee(T=>q(),["prevent"])),ref_key:"form",ref:t,class:"box"},[e("div",ds,[e("label",{class:"label",onClick:U[3]||(U[3]=T=>j())},"Nombre"),e("div",cs,[v(e("input",{class:X(["input upper",{"is-danger":s.value}]),onInput:U[4]||(U[4]=T=>D()),ref_key:"fieldName",ref:o,required:"","onUpdate:modelValue":U[5]||(U[5]=T=>l(i).name=T),type:"text",placeholder:"Nombre"},null,34),[[I,l(i).name,void 0,{trim:!0}]]),s.value?(g(),f("span",_s,"Ya existe un producto con este nombre")):M("",!0)])]),e("table",us,[e("thead",null,[e("tr",null,[Cs,Ps,gs,Ss,fs,e("th",null,[e("button",{type:"button",class:"button is-info",onClick:U[6]||(U[6]=T=>C())},"+")])])]),e("tbody",null,[(g(!0),f(G,null,K(P.value,(T,Y)=>(g(),Q(ns,{key:T.id,product:T,onQuit:U[7]||(U[7]=H=>h(H)),ref_for:!0,ref:H=>{H&&(S.value[Y]=H)}},null,8,["product"]))),128))])]),Es,n.productId!==-1?(g(),f("button",{key:0,type:"button",onClick:U[8]||(U[8]=T=>a("cancelEdit")),class:"button is-danger"},"Cancelar")):M("",!0)],544),c.value?(g(),f("div",Rs,Os)):M("",!0)],64))}}),hs={class:"columns"},vs={class:"column is-6"},Is={class:"column is-6"},bs=N({setup(d){const a=u(-1),n=o=>{a.value=o},r=()=>{a.value=-1};return(o,s)=>(g(),f("div",hs,[e("div",vs,[A(Us,{"product-id":a.value,onCancelEdit:s[0]||(s[0]=t=>r())},null,8,["product-id"])]),e("div",Is,[A(Ke,{onEditProduct:s[1]||(s[1]=t=>n(t))})])]))}}),ys={class:"menu"},Ts={class:"menu-list"},Ls=["onClick"],re=N({emits:["itemSelected"],setup(d,{emit:a}){const n=V(),r=u([]),o=u([]),s=u("");z(()=>{r.value=n.state.products});const t=()=>{if(s.value===""){o.value=[];return}const c=s.value.toLowerCase();o.value=r.value.filter(({name:E,code:i})=>E.toLowerCase().includes(c)||i.toString().toLowerCase().includes(c))};return(c,E)=>(g(),f("div",ys,[v(e("input",{class:"input upper",type:"search",onInput:E[0]||(E[0]=i=>t()),"onUpdate:modelValue":E[1]||(E[1]=i=>s.value=i),placeholder:"Buscar producto"},null,544),[[I,s.value,void 0,{trim:!0}]]),e("ul",Ts,[(g(!0),f(G,null,K(o.value,i=>(g(),f("li",{onClick:S=>a("itemSelected",i),key:i.id},y(i.name),9,Ls))),128))])]))}}),Ms={class:"control",style:{width:"6.5rem"}},ws={class:"control"},Fs=e("i",{class:"bi bi-trash"},null,-1),Ns=[Fs],ks=N({props:{product:Object},emits:["quit"],setup(d,{emit:a}){const n=d,r=$(n.product);return J(()=>{r.quantity=r.quantity<1?1:r.quantity,r.mount=r.quantity*r.priceSale}),(o,s)=>(g(),f("tr",null,[e("td",null,y(l(r).code),1),e("td",null,y(l(r).name),1),e("td",null,"S/. "+y(l(r).priceSale),1),e("td",Ms,[v(e("input",{class:"input is-upper",type:"number",min:"1",onClick:s[0]||(s[0]=t=>t.target.select()),placeholder:"Cantidad","onUpdate:modelValue":s[1]||(s[1]=t=>l(r).quantity=t)},null,512),[[I,l(r).quantity]])]),e("td",null,"S/. "+y(l(r).mount),1),e("td",ws,[e("button",{type:"button",class:"button is-danger",onClick:s[2]||(s[2]=t=>a("quit",n.product.id))},Ns)])]))}}),xs={key:0,class:"modal is-active"},Ws=e("div",{class:"modal-background"},null,-1),Vs={class:"modal-card"},Gs={class:"modal-card-head"},$s=e("p",{class:"modal-card-title"},"Nueva Venta",-1),js={class:"modal-card-body"},Hs={style:{display:"none"}},Bs={key:0,class:"column"},Ks={class:"field is-horizontal"},Js={class:"field-body"},Xs={class:"field has-addons"},qs={class:"control"},zs={class:"select"},Zs=["disabled"],Ys=["value"],Qs={class:"control"},eo=["placeholder"],so={class:"field"},oo={class:"control is-expanded"},no=["disabled"],ao={key:0,class:"field"},ro={class:"control is-expanded"},to={key:1,class:"notification is-danger mt-5"},io={class:"modal-card-foot"},lo=N({props:{show:Boolean,client:Object},emits:["save","hide"],setup(d,{emit:a}){const n=d,r=V(),o=u(n.show),s=u("ticket"),t=u(!1),c=u(""),E=[{code:1,name:"DNI",length:8},{code:4,name:"CARNET DE EXTRANGERIA",length:12},{code:6,name:"RUC",length:11},{code:7,name:"PASAPORTE",length:12}],i=$(n.client);J(()=>{o.value=n.show}),J(()=>{i.documentType=1,i.document="",i.name="",i.email="",s.value==="factura"&&(i.documentType=6,i.document="",i.name="")});const S=B(()=>E.find(h=>h.code===i.documentType)),P=async()=>{if(!(S.value.code!==1&&S.value.code!==6)&&(""+i.document).length===S.value.length){const h=await r.dispatch("getInfoDoc",{typeDoc:S.value.code,document:i.document});i.name=h.nombre}};J(()=>{t.value&&setTimeout(()=>{t.value=!1},2500)});const m=()=>{if(s.value!=="ticket"){if(i.document===""||i.name===""){c.value="El documento o el nombre no puede ser vacio",t.value=!0;return}if(s.value==="factura"&&i.email===""){c.value="Se nesesita un email para emitir factura",t.value=!0;return}}a("save",s.value)},C=()=>{i.document=i.document.replace(/\D/,""),i.document.length>S.value.length&&(i.document=i.document.slice(0,S.value.length))};return(h,D)=>o.value?(g(),f("div",xs,[Ws,e("div",Vs,[e("header",Gs,[$s,e("button",{class:"delete","aria-label":"close",onClick:D[0]||(D[0]=R=>a("hide"))})]),e("section",js,[e("label",{for:"ticket",class:X(["button",{"is-primary":s.value==="ticket"}])},"Ticket",2),e("label",{for:"boleta",class:X(["button",{"is-primary":s.value==="boleta"}])},"Boleta",2),e("label",{for:"factura",class:X(["button",{"is-primary":s.value==="factura"}])},"Factura",2),e("div",Hs,[v(e("input",{type:"radio","onUpdate:modelValue":D[1]||(D[1]=R=>s.value=R),id:"boleta",value:"boleta"},null,512),[[se,s.value]]),v(e("input",{type:"radio","onUpdate:modelValue":D[2]||(D[2]=R=>s.value=R),id:"factura",value:"factura"},null,512),[[se,s.value]]),v(e("input",{type:"radio","onUpdate:modelValue":D[3]||(D[3]=R=>s.value=R),id:"ticket",value:"ticket"},null,512),[[se,s.value]])]),s.value!=="ticket"?(g(),f("div",Bs,[e("div",Ks,[e("div",Js,[e("div",Xs,[e("p",qs,[e("span",zs,[v(e("select",{"onUpdate:modelValue":D[4]||(D[4]=R=>l(i).documentType=R),disabled:s.value==="factura"},[(g(),f(G,null,K(E,R=>e("option",{key:R.code,value:R.code},y(R.name),9,Ys)),64))],8,Zs),[[ae,l(i).documentType]])])]),e("p",Qs,[v(e("input",{class:"input is-upper",placeholder:l(S).name,onInput:D[5]||(D[5]=R=>(C(),P())),"onUpdate:modelValue":D[6]||(D[6]=R=>l(i).document=R)},null,40,eo),[[I,l(i).document]])])])])]),e("div",so,[e("p",oo,[v(e("input",{class:"input is-upper",placeholder:"nombre",type:"text","onUpdate:modelValue":D[7]||(D[7]=R=>l(i).name=R),disabled:l(i).documentType===6||l(i).documentType===1},null,8,no),[[I,l(i).name]])])]),s.value==="factura"?(g(),f("div",ao,[e("p",ro,[v(e("input",{class:"input",placeholder:"Email",type:"text","onUpdate:modelValue":D[8]||(D[8]=R=>l(i).email=R)},null,512),[[I,l(i).email]])])])):M("",!0)])):M("",!0),t.value?(g(),f("div",to,[e("button",{onClick:D[9]||(D[9]=R=>t.value=!1),class:"delete"}),Z(" "+y(c.value),1)])):M("",!0)]),e("footer",io,[e("button",{onClick:D[10]||(D[10]=R=>m()),class:"button is-success"},"Imprimir "+y(s.value),1),e("button",{onClick:D[11]||(D[11]=R=>a("hide")),class:"button"},"Cancelar")])])])):M("",!0)}}),po={class:"columns"},mo={class:"column is-4"},co={class:"field"},_o={class:"label"},uo={class:"control"},Co=["disabled"],Po={class:"field"},go={class:"column is-8"},So={class:"table is-bordered is-striped is-fullwidth"},fo=e("thead",null,[e("tr",null,[e("th",null,"Codigo"),e("th",null,"Nombre"),e("th",null,"Precio"),e("th",null,"Cantidad"),e("th",null,"Monto"),e("th")])],-1),Eo=e("th",{colspan:"4",style:{"text-align":"right"}},"TOTAL:",-1),Ro=e("th",null,null,-1),Ao=e("div",null,null,-1),Do=["disabled"],Oo={key:0,class:"notification is-danger mt-5"},Uo={style:{display:"none"}},ho=["srcdoc"],vo=N({setup(d){const a=V(),n=u(""),r=u(),o=u(!1),s=u([]),t=u(""),c=u(!1),E=u(!1),i=u(""),S=$({documentType:1,document:"",name:"",email:""}),P=B(()=>`
  <html>
  <head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300&display=swap" rel="stylesheet">
   <style>
  pre{
    font-family: 'Roboto Mono', monospace;
    font-weight: bold;
    padding:1rem;
    width:460px
    
  }
  </style></head>
  <body>
 
  <pre >
      ${C.value}
  </pre>
  </body>
  </html>
  `),m=O=>{if(O<=0)return"";let p="";for(let _=0;_<O;_++)p+=" ";return p},C=B(()=>`
            INVERSIONES VILVER E.I.R.L
      Jr. Grau Nro. 1032 Cajamarca-Cajabamba   

    BOLETA DE VENTA ELECTRONICA 0000-0000000

Fecha de emision:2006-04-09
ID Venta: 0000546-5s654-sds645-sds65

DNI Cliente:${S.document}
Nombre Cliente:${S.name}
${t.value}
                 Subtotal:           S/${Math.round((x.value*(100/118)+Number.EPSILON)*10)/10}
                 IGV(18%):           S/${Math.round((x.value*(18/118)+Number.EPSILON)*10)/10}
                 Total:              S/${x.value}
------------------------------------------------  `),h=O=>{let p="";for(let _=0;_<8-O.toString().length;_++)p+="0";return p+O.toString()},D=()=>{S.documentType=1,S.document="",S.name="",S.email="",s.value=[]},R=(O,p,_,F,b=[])=>{let k=`
    INVERSIONES VILVER E.I.R.L - RUC 20605808931
      Jr. Grau Nro. 1032 Cajamarca-Cajabamba  `;return p==="ticket"?k+=`
              TICKET DE VENTA ELECTRONICO 
      `:k+=`
         ${p.toLocaleUpperCase()} ELECTRONICA ${b.serie}-${h(b.correlative)}
      `,k+=`
Fecha de emision:${p!=="ticket"?b.dateTime:_.dateTime}
ID Venta: 00000${_.id}
  `,p!=="ticket"&&(k+=`
CLIENTE:
Documento: ${F.document}
Nombre: ${F.name}
`),k+=j(s.value),k+=`
                OP.GRAVADAS:        S/ ${Math.round((_.total*(100/118)+Number.EPSILON)*10)/10}
                   IGV(18%):        S/ ${Math.round((_.total*(18/118)+Number.EPSILON)*10)/10}
                 DESCUENTOS:        S/ -0.00
              IMPORTE TOTAL:        S/ ${_.total}
------------------------------------------------ 
${O}

************************************************
            !GRACIAS POR SU COMPRA!
`,k},j=O=>{let p="",_="",F=`
------------------------------------------------
`;return F+=`PRODUCTO                 CANT P.UNI   MONTO
`,F+=`------------------------------------------------
`,O.forEach(b=>{p=b.name.slice(0,24)+m(24-b.name.length),p+="  ",p+=""+b.quantity+m(3-(""+b.quantity).length),p+=" S/",p+=""+b.priceSale+m(6-(""+b.priceSale).length),p+=" S/",p+=""+b.mount+m(7-(""+b.mount).length),F+=`${p}
`,b.name.length>24&&(_=b.name.length>48?b.name.slice(24,45)+"...":b.name.slice(24),F+=`${_}
`)}),F+=`------------------------------------------------
`,F},x=B(()=>s.value.reduce((O,p)=>O+p.mount,0)),q=O=>a.state.products.find(({code:_})=>_.toString()===n.value),L=({id:O,code:p,name:_,priceSale:F})=>{const b={id:O,code:p,name:_,priceSale:F,quantity:1,mount:F*1};if(s.value.every(k=>k.id!==O))s.value.push(b);else{const k=s.value.findIndex(pe=>pe.id===O);s.value[k].quantity+=1,s.value[k].mount=b.priceSale*s.value[k].quantity}s.value.length===0&&s.value.push(b),n.value=""},U=O=>{const p=s.value.findIndex(_=>_.id===O);s.value.splice(p,1)};z(async()=>{try{const p=await(await fetch("http://localhost:5050/devices")).json()}catch{E.value=!0,i.value="No se encuentra el controlador de la impresora por favor inicie el controlador y configure la impresora"}});const T=()=>{const O=n.value;setTimeout(()=>{if(n.value===O){const p=q(n.value);p&&L(p),n.value=""}},100)},Y=async O=>{const p=await a.dispatch("saveSale",{soldProducts:s.value,client:S,typeProof:O});let _;O!=="ticket"?p.proof.status!=="ACEPTADA"?(i.value=p.proof.description,E.value=!0,setTimeout(()=>{E.value=!1},3e3)):_=R(p.legend,O,p.sale,p.client,p.proof.data):_=R(p.legend,O,p.sale,p.client,[]),await a.dispatch("printerTicket",{text:_}),D(),c.value=!1,console.log(_)},H=()=>{n.value="",r.value.focus()},le=()=>{if(s.value.some(O=>O.priceSale===0)){i.value="Los precios no pueden ser cero",E.value=!0,setTimeout(()=>{E.value=!1},3e3);return}c.value=!0};return(O,p)=>(g(),f(G,null,[A(lo,{show:c.value,onHide:p[0]||(p[0]=_=>c.value=!1),client:l(S),onSave:p[1]||(p[1]=_=>Y(_))},null,8,["show","client"]),e("div",po,[e("div",mo,[v(e("input",{required:"",autocomplete:"off",onInput:p[2]||(p[2]=_=>T()),style:{position:"absolute","pointer-events":"none",opacity:"0"},onClick:p[3]||(p[3]=_=>_.target.blur()),onBlur:p[4]||(p[4]=_=>o.value=!1),onFocus:p[5]||(p[5]=_=>o.value=!0),ref_key:"fieldCode",ref:r,"onUpdate:modelValue":p[6]||(p[6]=_=>n.value=_)},null,544),[[I,n.value]]),e("div",co,[e("label",_o,"Codigo "+y(": "+n.value),1),e("div",uo,[e("button",{tabindex:"-1",class:"button is-success",disabled:o.value,type:"button",onClick:p[7]||(p[7]=_=>H())},y(o.value?"Escaneando codigos...":"Escanear codigos"),9,Co)])]),e("div",Po,[A(re,{onItemSelected:p[8]||(p[8]=_=>L(_))})])]),e("div",go,[e("table",So,[fo,e("tbody",null,[(g(!0),f(G,null,K(s.value,_=>(g(),Q(ks,{key:_.id,product:_,onQuit:p[9]||(p[9]=F=>U(F))},null,8,["product"]))),128)),e("tr",null,[Eo,e("th",null,"S/. "+y(l(x)),1),Ro])])]),Ao,e("button",{disabled:s.value.length===0,onClick:p[10]||(p[10]=_=>le()),class:"button is-primary"},"Realizar venta",8,Do),E.value?(g(),f("div",Oo,[e("button",{onClick:p[11]||(p[11]=_=>E.value=!1),class:"delete"}),Z(" "+y(i.value),1)])):M("",!0)]),e("div",Uo,[e("iframe",{style:{width:"550px",height:"900px",padding:"0"},name:"page-printer",srcdoc:l(P)},null,8,ho)])])],64))}}),Io={class:"columns"},bo={class:"column"},yo=["value"],To=N({setup(d){const a=u([]),n=u("");z(async()=>{const s=await(await fetch("http://localhost:5050/devices")).json();a.value=s,n.value=localStorage.printer});const r=()=>{localStorage.printer=n.value};return(o,s)=>(g(),f("div",Io,[e("div",bo,[v(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t)},[(g(!0),f(G,null,K(a.value,t=>(g(),f("option",{key:t.vendor_id,value:t.product_id+"/"+t.vendor_id},y(t.vendor_id)+":"+y(t.product_id)+" "+y(t.name),9,yo))),128))],512),[[ae,n.value]]),e("button",{class:"button is-primary",onClick:s[1]||(s[1]=t=>r())},"Guardar")])]))}}),Lo=["onSubmit"],Mo={class:"field"},wo=e("label",{class:"label"},"Usuario",-1),Fo={class:"control has-icons-left"},No={class:"field"},ko=e("label",{class:"label"},"Contrase\xF1a",-1),xo={class:"control has-icons-left"},Wo={class:"field"},Vo={class:"control is-expanded"},Go=e("button",{class:"button is-primary is-medium input mt-2"},"Iniciar Sesion",-1),$o={key:0,class:"help is-danger"},jo=N({setup(d){const a=V(),n=u(!1),r=fe(),o=$({userName:"",password:""}),s=async()=>{const t=await a.dispatch("userLogin",{credentials:o});if(n.value=!t.success,t.success){const c=await a.dispatch("fetchProducts");console.log(c),r.replace("products")}console.log(t.message)};return(t,c)=>(g(),f("form",{onSubmit:ee(s,["prevent"]),class:"box column is-4 is-offset-4"},[e("div",Mo,[wo,e("div",Fo,[v(e("input",{class:"input is-medium",ref:"fieldName",required:"","onUpdate:modelValue":c[0]||(c[0]=E=>l(o).userName=E),placeholder:"Nombre de usuario"},null,512),[[I,l(o).userName]]),A(l(W),{class:"icon is-large is-left"},{default:w(()=>[A(l(Ee))]),_:1})])]),e("div",No,[ko,e("div",xo,[v(e("input",{class:"input is-medium",required:"","onUpdate:modelValue":c[1]||(c[1]=E=>l(o).password=E),type:"password",placeholder:"************"},null,512),[[I,l(o).password]]),A(l(W),{class:"icon is-large is-left"},{default:w(()=>[A(l(Re))]),_:1})])]),e("div",Wo,[e("p",Vo,[Go,n.value?(g(),f("span",$o,"Error al iniciar session")):M("",!0)])])],40,Lo))}}),Ho=["onSubmit"],Bo={class:"field"},Ko={class:"control"},Jo={key:0,class:"help is-danger"},Xo={class:"field"},qo=e("label",{class:"label"},"DNI",-1),zo={class:"control"},Zo={class:"field"},Yo=e("label",{class:"label"},"Nombres y Apellidos",-1),Qo={class:"control"},en={class:"field"},sn=e("label",{class:"label"},"Contrase\xF1a",-1),on={class:"control"},nn={key:0,class:"help is-danger"},an={class:"field"},rn=e("label",{class:"label"},"Repetir Contrase\xF1a",-1),tn={class:"control"},ln={key:0,class:"help is-danger"},pn={class:"field"},mn=e("label",{class:"label"},"Celular",-1),dn={class:"control"},cn={class:"field"},_n=e("label",{class:"label"},"Email",-1),un={class:"control"},Cn=e("button",{class:"button is-primary"},"Registrar usuario",-1),Pn=N({setup(d){const a=u(),n=V(),r=u(!1),o=u([]),s=$({userName:"",dni:"",fullName:"",email:"",password:"",roleId:"1",mobile:""}),t=u(""),c=u(!1),E=()=>{s.password!==t.value?c.value=!0:c.value=!1};z(async()=>{const S=await n.dispatch("fetchRoles");o.value=S.data});const i=async()=>{if(s.password!==t.value){c.value=!0;return}const S=await n.dispatch("userSignup",{user:s});r.value=S.success,S.success&&(a.value.reset(),alert(`usuario registrado 
 UserName: `+S.data.userName)),console.log(S.message)};return(S,P)=>(g(),f("form",{onSubmit:ee(i,["prevent"]),ref_key:"form",ref:a},[e("div",Bo,[e("div",Ko,[r.value?M("",!0):(g(),f("span",Jo,"Ya existe un producto con este codigo"))])]),e("div",Xo,[qo,e("div",zo,[v(e("input",{class:"input",ref:"fieldName","onUpdate:modelValue":P[0]||(P[0]=m=>l(s).dni=m),type:"number",placeholder:"documento de identidad"},null,512),[[I,l(s).dni]])])]),e("div",Zo,[Yo,e("div",Qo,[v(e("input",{class:"input",ref:"fieldName",required:"","onUpdate:modelValue":P[1]||(P[1]=m=>l(s).fullName=m),type:"text",placeholder:"Nombres y apellidos"},null,512),[[I,l(s).fullName]])])]),e("div",en,[sn,e("div",on,[v(e("input",{class:X(["input",{"is-danger":c.value}]),required:"",step:"0.1","onUpdate:modelValue":P[2]||(P[2]=m=>l(s).password=m),type:"password",placeholder:"Contrase\xF1a"},null,2),[[I,l(s).password]]),c.value?(g(),f("span",nn,"Las contrase\xF1as deven ser iguales")):M("",!0)])]),e("div",an,[rn,e("div",tn,[v(e("input",{class:X(["input",{"is-danger":c.value}]),onBlur:P[3]||(P[3]=m=>E()),required:"",step:"0.1","onUpdate:modelValue":P[4]||(P[4]=m=>t.value=m),type:"password",placeholder:"Vuelva a escribir la contrase\xF1a"},null,34),[[I,t.value]]),c.value?(g(),f("span",ln,"Las contrase\xF1as deven ser iguales")):M("",!0)])]),e("div",pn,[mn,e("div",dn,[v(e("input",{class:"input",step:"0.1","onUpdate:modelValue":P[5]||(P[5]=m=>l(s).mobile=m),type:"number",placeholder:"Numero de celular"},null,512),[[I,l(s).mobile]])])]),e("div",cn,[_n,e("div",un,[v(e("input",{class:"input",ref:"fieldName","onUpdate:modelValue":P[6]||(P[6]=m=>l(s).email=m),type:"text",placeholder:"Correo electronico"},null,512),[[I,l(s).email]])])]),Cn],40,Ho))}}),gn={class:"menu"},Sn=["srcdoc"],fn=N({props:{product:Object,stock:Number},setup(d){const a=d,n=u(),r=u(),o=u("");J(async()=>{Ae("#barcode",a.product.code,{displayValue:!1,height:20,width:1,margin:0}),await s(a.product,a.stock)});const s=async(t,c)=>{const E=r.value.src;let i=`
   <html>
  <head>
  <style>
  *{

  }
  </style>
   </head>
   <body style="width:108mm;padding:0;margin:0">
   <div style="margin:0 2.5mm;padding:0;width:103mm;display:grid;grid-template-columns: repeat(3, 1fr);font-family:arial;font-weight: bold;justify-content:center ;height:21mm ;page-break-after: always">`;for(let S=0;S<c;S++)i+=`<div style="display: flex;flex-direction: column;align-items: center;font-size: 10px;widt:30mm;max-width:30mm;border:1px solid black;padding:2px;text-align:center;height;20mm">
    <span style="margin: 0;padding: 0;z-index: 1;word-wrap:break-word;word-break: break-all;">${t.name}</span>
    <img style="width:29mm" src="${E}"/>
    <span style="margin: 0;padding: 0;z-index: 1">${t.code}</span>
    </div>`;i+=`</div> </body>
  </html>`,o.value=i};return(t,c)=>(g(),f("div",gn,[e("iframe",{id:"printf",name:"printf",ref_key:"pdf",ref:n,style:{width:"1000px",height:"900px",border:"1x solid red"},srcdoc:o.value},null,8,Sn),e("img",{ref_key:"img",ref:r,id:"barcode",style:{display:"none"}},null,512)]))}}),En={class:"columns"},Rn={class:"column is-4"},An={class:"field"},Dn=e("label",{class:"label"},"Usuario",-1),On={class:"control"},Un=N({setup(d){const a=u({}),n=u(9),r=()=>{const s=window;s.frames.printf.focus(),s.frames.printf.print()},o=s=>{a.value=s,console.log(s.code)};return(s,t)=>(g(),f("div",En,[e("form",Rn,[e("div",An,[Dn,e("div",On,[v(e("input",{type:"number",class:"input is-medium",ref:"fieldName",required:"","onUpdate:modelValue":t[0]||(t[0]=c=>n.value=c),placeholder:"Cantidad"},null,512),[[I,n.value,void 0,{number:!0}]])])]),e("button",{type:"button",onClick:t[1]||(t[1]=c=>r()),class:"button is-primary is-medium"},"Imprimir Codigos"),A(re,{onItemSelected:t[2]||(t[2]=c=>o(c))})]),A(fn,{class:"column is-8",product:a.value,stock:n.value},null,8,["product","stock"])]))}}),hn=[{path:"/login",name:"login",component:jo},{path:"/sales",name:"sales",component:vo},{path:"/printers",name:"printers",component:To},{path:"/products",name:"products",component:bs},{path:"/signup",name:"signup",component:Pn},{path:"/barcodes",name:"barcodes",component:Un}],te=De({history:Oe(),routes:hn});te.beforeEach(async(d,a)=>{if(!oe.state.isAuthenticated&&d.name!=="login")return{name:"login"};if(oe.state.isAuthenticated&&d.name==="login")return{name:"sales"}});const ie=Ue(Fe);ie.use(oe).use(te).mount("#app");ie.config.globalProperties.$log=console.log;
