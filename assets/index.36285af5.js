import{d as N,u as V,c as K,a as E,b as i,e as O,w,f as ee,g as L,h as e,r as ae,o as g,I as W,B as _e,S as ue,i as Ce,j as Pe,P as Se,k as ge,l as C,m as Y,n as U,v as I,p as fe,A as Ee,F as $,q as X,t as y,E as Re,s as j,x as Z,y as H,z as J,C as se,D as oe,G as re,H as Oe,J as Ae,K as De,L as Ue,M as he,N as ve,O as Ie}from"./vendor.49dc3b86.js";const be=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};be();const ye={class:"is-fluid columns p-5"},Me={key:0,class:"column is-1"},Te=e("span",null,"Productos",-1),Le=e("span",null,"Ventas",-1),Fe=e("span",null,"Configs",-1),Ne=e("span",null,"Barcodes",-1),we=e("span",null,"Usuarios",-1),ke={class:"column is-11"},xe=N({setup(c){const a=V(),n=K(()=>a.state.user.userName),t=K(()=>a.state.isAuthenticated);return(o,s)=>{const r=ae("router-link"),d=ae("router-view");return g(),E("main",ye,[i(t)?(g(),E("div",Me,[O(r,{class:"item_menu",to:"/products"},{default:w(()=>[O(i(W),{size:"30"},{default:w(()=>[O(i(_e))]),_:1}),Te]),_:1}),O(r,{class:"item_menu",to:"/sales"},{default:w(()=>[O(i(W),{size:"30"},{default:w(()=>[O(i(ue))]),_:1}),Le]),_:1}),O(r,{class:"item_menu",to:"/printers"},{default:w(()=>[O(i(W),{size:"30"},{default:w(()=>[O(i(Ce))]),_:1}),Fe]),_:1}),O(r,{class:"item_menu",to:"/barcodes"},{default:w(()=>[O(i(W),{size:"30"},{default:w(()=>[O(i(Pe))]),_:1}),Ne]),_:1}),i(n)==="Balta"?(g(),ee(r,{key:0,class:"button is-link",to:"/signup"},{default:w(()=>[O(i(W),{size:"30"},{default:w(()=>[O(i(Se))]),_:1}),we]),_:1})):L("",!0)])):L("",!0),e("div",ke,[O(d)])])}}});var ne=ge({state:{products:[],user:{},isAuthenticated:!1},mutations:{test(){console.log("hola desde vuex")}},actions:{async fetchProducts({state:c}){try{const n=await(await fetch("http://localhost:80/vilcherrez_api/api/v1/products")).json();return n.success&&(c.products=n.data.reverse()),n}catch(a){return console.log(a.type),{success:!0,message:a}}},async fetchSales({state:c}){try{const n=await(await fetch("http://localhost:80/vilcherrez_api/api/v1/sales",{headers:{Authorization:`bearer ${c.user.token} `}})).json();return n.success&&(c.products=n.data.reverse()),n}catch(a){return console.log(a.type),{success:!0,message:a}}},async fetchPackProducts({state:c},{id:a}){try{return await(await fetch(`http://localhost:80/vilcherrez_api/api/v1/pack_product/${a}`,{headers:{Authorization:`bearer ${c.user.token} `}})).json()}catch(n){return{data:null,success:!0,message:n}}},async fetchRoles(){try{return await(await fetch("http://localhost:80/vilcherrez_api/api/v1/user_roles")).json()}catch(c){return{success:!0,message:c}}},async userLogin({state:c},{credentials:a}){try{const t=await(await fetch("http://localhost:80/vilcherrez_api/api/v1/login",{method:"POST",body:JSON.stringify(a)})).json();return console.log(t),t.success&&(c.user=t.data,c.isAuthenticated=t.success,localStorage.token=t.data.token),t}catch(n){return console.log(n),{success:!1,message:n}}},async userSignup({state:c},{user:a}){try{return await(await fetch("http://localhost:80/vilcherrez_api/api/v1/signup",{method:"POST",body:JSON.stringify(a)})).json()}catch(n){return console.log(n),{success:!1,message:n}}},async saveProduct({state:c},{action:a,product:n}){try{const o=await(await fetch("http://localhost:80/vilcherrez_api/api/v1/product",{method:a==="add"?"POST":"PUT",headers:{Authorization:`bearer ${c.user.token} `},body:JSON.stringify(n)})).json();if(o.success&&(a==="add"&&c.products.unshift(o.data),a==="edit")){const s=c.products.findIndex(r=>r.id===n.id);console.log(s),c.products[s]=o.data}return o}catch{}},async savePackingProduct({state:c},{action:a,data:n}){console.log({action:a});try{return await(await fetch("http://localhost:80/vilcherrez_api/api/v1/product",{method:a==="add"?"POST":"PUT",headers:{Authorization:`bearer ${c.user.token} `},body:JSON.stringify(n)})).json()}catch{}},async printerTicket(c,{text:a}){return await(await fetch(`http://localhost:5050/printer/${localStorage.printer}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,qr_content:"hola mundo"})})).text()},async testEncode(c,{text:a}){return await(await fetch("http://localhost:5050/decodeurl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,qr_content:"hola mundo"})})).text()},async getInfoDoc({state:c},{typeDoc:a,document:n}){let t;return console.log(a),a===1&&(t=await fetch(`http://localhost:80/vilcherrez_api/api/v1/dni/${n}`,{headers:{Authorization:`bearer ${c.user.token} `}})),a===6&&(t=await fetch(`http://localhost:80/vilcherrez_api/api/v1/ruc/${n}`,{headers:{Authorization:`bearer ${c.user.token} `}})),(await t.json()).data},async saveSale({state:c},{soldProducts:a,client:n,typeProof:t}){return(await(await fetch("http://localhost:80/vilcherrez_api/api/v1/sale",{method:"POST",headers:{Authorization:`bearer ${c.user.token} `},body:JSON.stringify({soldProducts:a,client:n,userId:c.user.id,typeProof:t})})).json()).data}},modules:{}});const We={class:"columns"},Ge={class:"column is-11"},Ve={class:"control has-icons-left"},$e={class:"column is-1"},je={class:"h-100 oy-scroll"},He={class:"table is-narrow is-hoverable is-bordered is-striped is-fullwidth"},Be=e("thead",null,[e("tr",{style:{position:"sticky"}},[e("th",null,"Codigo"),e("th",null,"Nombre"),e("th",null,"Precio"),e("th",null,"Cantidad"),e("th")])],-1),Ke={style:{"padding-top":"2px"}},Xe=["onClick"],Je=["onClick"],qe=N({emits:["editProduct"],setup(c,{emit:a}){const n=V(),t=C([]),o=C([]),s=C("");Y(async()=>{t.value=n.state.products,o.value=n.state.products});const r=()=>{const _=s.value.toLowerCase().split(" "),p=[];_.forEach((S,v)=>{if(S.length<2)return;t.value.filter(({name:R,code:D})=>R.toLowerCase().includes(S)||D.toString().toLowerCase().includes(S)).forEach((R,D)=>{if(p.length===0){p.push(R);return}if(p.every(({id:G})=>G!==R.id))p.push(R);else{const G=p.findIndex(({id:q})=>q===R.id);p.splice(G,1),p.unshift(R)}})}),o.value=p},d=m=>{console.log("hola")},f=m=>{navigator.clipboard.writeText(m.name)},P=async()=>{await n.dispatch("fetchProducts"),t.value=n.state.products,o.value=n.state.products};return(m,_)=>(g(),E($,null,[e("div",We,[e("div",Ge,[e("div",Ve,[U(e("input",{class:"input",type:"search",onInput:_[0]||(_[0]=p=>r()),"onUpdate:modelValue":_[1]||(_[1]=p=>s.value=p),placeholder:"Buscar producto"},null,544),[[I,s.value,void 0,{trim:!0}]]),O(i(W),{class:"icon is-large is-left"},{default:w(()=>[O(i(fe))]),_:1})])]),e("div",$e,[e("button",{class:"button is-primary",onClick:_[2]||(_[2]=p=>P())},[O(i(W),{class:"icon is-large is-left"},{default:w(()=>[O(i(Ee))]),_:1})])])]),e("div",je,[e("table",He,[Be,e("tbody",Ke,[(g(!0),E($,null,X(o.value,p=>(g(),E("tr",{key:p.id},[e("td",null,y(p.code),1),e("td",{style:{cursor:"copy"},onClick:S=>f(p)},y(p.name),9,Xe),e("td",null,"S/."+y(p.priceSale),1),e("td",null,y(p.stock),1),e("td",null,[e("button",{class:"button is-info is-small",onClick:S=>(d(),a("editProduct",p.productId))},[O(i(W),null,{default:w(()=>[O(i(Re))]),_:1})],8,Je)])]))),128))])])])],64))}}),ze={class:"control"},Ye={key:0,class:"help is-danger"},Ze=["disabled","value"],Qe={class:"control"},es={class:"control"},ss={class:"control"},os={class:"control"},ns={class:"control"},as=e("i",{class:"bi bi-trash"},null,-1),rs=[as],ts=N({props:{product:Object},emits:["quit"],setup(c,{emit:a}){const n=c,t=V(),o=j(n.product),s=C(!1),r=C(!1),d=C(),f=()=>{if(o.priceBuy===0)return;let p=0;switch(o.packing.toLocaleUpperCase()){case"UND":p=.5;break;case"10 UND":p=.25;break;case"12 UND":p=.25;break;case"100 UND":p=.15;break}if(p!==0){const S=o.priceBuy+o.priceBuy*p;o.packing==="UND"?o.priceSale=Math.round((S+Number.EPSILON)*10)/10:o.priceSale=Math.ceil(S)}},P=()=>{const p=o.code;setTimeout(()=>{o.code===p&&d.value.blur()},100)};o.productId;const m=()=>(o.productId!==void 0?r.value=t.state.products.some(({code:p,productId:S})=>p.toString()===o.code&&S!==o.productId):r.value=t.state.products.some(({code:p})=>p.toString()===o.code),s.value=!1,r.value),_=()=>{o.code="",r.value=!1,d.value.focus()};return(p,S)=>(g(),E("tr",null,[e("td",ze,[U(e("input",{autocomplete:"off",onInput:S[0]||(S[0]=v=>P()),style:{position:"absolute","pointer-events":"none",opacity:"0"},onClick:S[1]||(S[1]=v=>v.target.blur()),onBlur:S[2]||(S[2]=v=>m()),onFocus:S[3]||(S[3]=v=>s.value=!0),ref_key:"codeField",ref:d,"onUpdate:modelValue":S[4]||(S[4]=v=>i(o).code=v)},null,544),[[I,i(o).code]]),r.value?(g(),E("span",Ye,"Ya hay un producto con este codigo")):L("",!0),Z(" "+y(i(o).code)+" ",1),e("input",{type:"button",onClick:S[5]||(S[5]=v=>_()),disabled:s.value,value:s.value?"Esperando escaneo...":"Escanear codigo",class:"button is-info"},null,8,Ze)]),e("td",Qe,[U(e("input",{class:"input is-upper",placeholder:"10UND","onUpdate:modelValue":S[6]||(S[6]=v=>i(o).packing=v)},null,512),[[I,i(o).packing]])]),e("td",es,[U(e("input",{class:"input is-upper",type:"number",step:"0.01",placeholder:"precio de compra","onUpdate:modelValue":S[7]||(S[7]=v=>i(o).priceBuy=v),onInput:S[8]||(S[8]=v=>f())},null,544),[[I,i(o).priceBuy]])]),e("td",ss,[U(e("input",{class:"input is-upper",type:"number",step:"0.01",placeholder:"Precio de Venta","onUpdate:modelValue":S[9]||(S[9]=v=>i(o).priceSale=v)},null,512),[[I,i(o).priceSale]])]),e("td",os,[U(e("input",{class:"input is-upper",type:"number",placeholder:"Cantidad","onUpdate:modelValue":S[10]||(S[10]=v=>i(o).stock=v)},null,512),[[I,i(o).stock]])]),e("td",ns,[e("button",{type:"button",class:"button is-danger",onClick:S[11]||(S[11]=v=>a("quit",n.product.id))},rs)])]))}}),is={key:0,class:"modal is-active"},ls=e("div",{class:"modal-background"},null,-1),ps={class:"modal-card"},ds={class:"modal-card-head"},ms=e("p",{class:"modal-card-title"},"Advertencia",-1),cs=e("section",{class:"modal-card-body"},"Algunos codigos estan vacios, \xBFquiere guardar de todas formas?",-1),_s={class:"modal-card-foot"},us={class:"field"},Cs={class:"control"},Ps={key:0,class:"help is-danger"},Ss={class:"table is-bordered"},gs=e("th",null,"CODIGO",-1),fs=e("th",null,"PACKING",-1),Es=e("th",null,"PRECIO DE COMPRA",-1),Rs=e("th",null,"PRECIO DE VENTA",-1),Os=e("th",null,"CANTIDAD",-1),As=e("button",{class:"button is-primary"},"Guardar producto",-1),Ds={key:1,class:"notification is-success"},Us=e("button",{class:"delete"},null,-1),hs=Z(" Producto guardado con exito "),vs=[Us,hs],Is=N({props:{productId:{type:Number,default:-1}},emits:["cancelEdit"],setup(c,{emit:a}){const n=c,t=V(),o=C(),s=C(!1),r=C(),d=C(!1),f=C(!1),P=j({id:0,name:"",brand:"",tags:"",description:"",features:{},image:""}),m=C([]),_=C([{id:"V"+Date.now()+1,code:"",packing:"UND",measureUnit:"NIU",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+2,code:"",packing:"12 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+3,code:"",packing:"100 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0}]),p=()=>{_.value=[{id:"V"+Date.now()+1,code:"",packing:"UND",measureUnit:"NIU",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+2,code:"",packing:"12 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0},{id:"V"+Date.now()+3,code:"",packing:"100 UND",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0}],P.name="",P.brand="",P.tags="",P.features={},P.description="",P.image="",a("cancelEdit")};H(async()=>{if(n.productId!==-1){const M=await t.dispatch("fetchPackProducts",{id:n.productId});_.value=M.data.packedProducts,P.name=M.data.product.name,P.id=M.data.product.id}else p()});const S=()=>{_.value.push({id:"V"+Date.now(),code:"",packing:"",measureUnit:"BX",priceSale:0,priceBuy:0,stock:0})},v=M=>{if(_.value.length===1)return;const h=_.value.findIndex(b=>b.id===M);_.value.splice(h,1)},x=()=>(n.productId!==-1?s.value=t.state.products.some(({name:M,productId:h})=>M.toLowerCase()===P.name.toLowerCase()&&h!==P.id):s.value=t.state.products.some(({name:M})=>M.toLowerCase()===P.name.toLowerCase()),s.value),R=async()=>{if(s.value)return;f.value=!1;const M={action:n.productId!==-1?"edit":"add",data:{product:P,packedProducts:[..._.value]}};(await t.dispatch("savePackingProduct",M)).success&&(p(),G())},D=()=>{o.value.select()},G=()=>{d.value=!0,setTimeout(()=>{d.value=!1},2e3)},q=async()=>{const M={action:n.productId!==-1?"edit":"add",data:{product:P,packedProducts:[..._.value]}};if(x())return;if(_.value.some(b=>b.code==="")){f.value=!0;return}(await t.dispatch("savePackingProduct",M)).success&&(p(),G())};return(M,h)=>(g(),E($,null,[f.value?(g(),E("div",is,[ls,e("div",ps,[e("header",ds,[ms,e("button",{class:"delete","aria-label":"close",onClick:h[0]||(h[0]=b=>f.value=!1)})]),cs,e("footer",_s,[e("button",{onClick:h[1]||(h[1]=b=>R()),class:"button is-success"},"Guradar"),e("button",{onClick:h[2]||(h[2]=b=>f.value=!1),class:"button"},"Cancelar")])])])):L("",!0),e("form",{onSubmit:h[9]||(h[9]=se(b=>q(),["prevent"])),ref_key:"form",ref:r,class:"box"},[e("div",us,[e("label",{class:"label",onClick:h[3]||(h[3]=b=>D())},"Nombre"),e("div",Cs,[U(e("input",{class:J(["input upper",{"is-danger":s.value}]),onInput:h[4]||(h[4]=b=>x()),ref_key:"fieldName",ref:o,required:"","onUpdate:modelValue":h[5]||(h[5]=b=>i(P).name=b),type:"text",placeholder:"Nombre"},null,34),[[I,i(P).name,void 0,{trim:!0}]]),s.value?(g(),E("span",Ps,"Ya existe un producto con este nombre")):L("",!0)])]),e("table",Ss,[e("thead",null,[e("tr",null,[gs,fs,Es,Rs,Os,e("th",null,[e("button",{type:"button",class:"button is-info",onClick:h[6]||(h[6]=b=>S())},"+")])])]),e("tbody",null,[(g(!0),E($,null,X(_.value,(b,Q)=>(g(),ee(ts,{key:b.id,product:b,onQuit:h[7]||(h[7]=B=>v(B)),ref_for:!0,ref:B=>{B&&(m.value[Q]=B)}},null,8,["product"]))),128))])]),As,n.productId!==-1?(g(),E("button",{key:0,type:"button",onClick:h[8]||(h[8]=b=>a("cancelEdit")),class:"button is-danger"},"Cancelar")):L("",!0)],544),d.value?(g(),E("div",Ds,vs)):L("",!0)],64))}}),bs={class:"columns"},ys={class:"column is-6"},Ms={class:"column is-6"},Ts=N({setup(c){const a=C(-1),n=o=>{a.value=o},t=()=>{a.value=-1};return(o,s)=>(g(),E("div",bs,[e("div",ys,[O(Is,{"product-id":a.value,onCancelEdit:s[0]||(s[0]=r=>t())},null,8,["product-id"])]),e("div",Ms,[O(qe,{onEditProduct:s[1]||(s[1]=r=>n(r))})])]))}}),Ls={class:"menu"},Fs={class:"menu-list"},Ns=["onClick"],te=N({emits:["itemSelected"],setup(c,{emit:a}){const n=V(),t=C([]),o=C([]),s=C("");Y(async()=>{await n.dispatch("fetchProducts"),t.value=n.state.products});const r=()=>{if(s.value===""){o.value=[];return}const d=s.value.toLowerCase();o.value=t.value.filter(({name:f,code:P})=>f.toLowerCase().includes(d)||P.toString().toLowerCase().includes(d))};return(d,f)=>(g(),E("div",Ls,[U(e("input",{class:"input upper",type:"search",onInput:f[0]||(f[0]=P=>r()),"onUpdate:modelValue":f[1]||(f[1]=P=>s.value=P),placeholder:"Buscar producto"},null,544),[[I,s.value,void 0,{trim:!0}]]),e("ul",Fs,[(g(!0),E($,null,X(o.value,P=>(g(),E("li",{onClick:m=>a("itemSelected",P),key:P.id},y(P.name),9,Ns))),128))])]))}}),ws={class:"control",style:{width:"6.5rem"}},ks={class:"control"},xs=e("i",{class:"bi bi-trash"},null,-1),Ws=[xs],Gs=N({props:{product:Object},emits:["quit"],setup(c,{emit:a}){const n=c,t=j(n.product);return H(()=>{t.quantity=t.quantity<1?1:t.quantity,t.mount=t.quantity*t.priceSale}),(o,s)=>(g(),E("tr",null,[e("td",null,y(i(t).code),1),e("td",null,y(i(t).name),1),e("td",null,"S/. "+y(i(t).priceSale),1),e("td",ws,[U(e("input",{class:"input is-upper",type:"number",min:"1",onClick:s[0]||(s[0]=r=>r.target.select()),placeholder:"Cantidad","onUpdate:modelValue":s[1]||(s[1]=r=>i(t).quantity=r)},null,512),[[I,i(t).quantity]])]),e("td",null,"S/. "+y(i(t).mount),1),e("td",ks,[e("button",{type:"button",class:"button is-danger",onClick:s[2]||(s[2]=r=>a("quit",n.product.id))},Ws)])]))}}),Vs={key:0,class:"modal is-active"},$s=e("div",{class:"modal-background"},null,-1),js={class:"modal-card"},Hs={class:"modal-card-head"},Bs=e("p",{class:"modal-card-title"},"Agregar producto manual",-1),Ks={class:"modal-card-body"},Xs={class:"field is-horizontal"},Js=e("div",{class:"field-label is-normal"},[e("label",{class:"label"},"Nombre del producto")],-1),qs={class:"field-body"},zs={class:"field"},Ys={class:"control"},Zs={class:"field is-horizontal"},Qs=e("div",{class:"field-label is-normal"},[e("label",{class:"label"},"Precio")],-1),eo={class:"field-body"},so={class:"field"},oo={class:"control",style:{width:"7rem"}},no={class:"modal-card-foot"},ao=N({props:{show:Boolean},emits:["addProduct","hide"],setup(c,{emit:a}){const n=c,t=C(n.show),o=j({id:"MP"+Date.now(),code:"MP"+Date.now(),name:"",priceSale:0,quantity:1}),s=()=>{a("addProduct",o),o.id="MP"+Date.now(),o.code="MP"+Date.now(),o.name="",o.priceSale=0,o.quantity=1,a("hide")};return H(()=>{t.value=n.show}),(r,d)=>t.value?(g(),E("div",Vs,[$s,e("div",js,[e("header",Hs,[Bs,e("button",{class:"delete","aria-label":"close",onClick:d[0]||(d[0]=f=>a("hide"))})]),e("section",Ks,[e("div",Xs,[Js,e("div",qs,[e("div",zs,[e("p",Ys,[U(e("input",{class:"input is-upper",placeholder:"NOMBRE","onUpdate:modelValue":d[1]||(d[1]=f=>i(o).name=f)},null,512),[[I,i(o).name]])])])])]),e("div",Zs,[Qs,e("div",eo,[e("div",so,[e("p",oo,[U(e("input",{class:"input is-upper",placeholder:"Precio",min:"0.1",step:"0.01","onUpdate:modelValue":d[2]||(d[2]=f=>i(o).priceSale=f)},null,512),[[I,i(o).priceSale]])])])])])]),e("footer",no,[e("button",{onClick:d[3]||(d[3]=f=>s()),class:"button is-success"},"Agregar producto"),e("button",{onClick:d[4]||(d[4]=f=>a("hide")),class:"button"},"Cancelar")])])])):L("",!0)}}),ro={key:0,class:"modal is-active"},to=e("div",{class:"modal-background"},null,-1),io={class:"modal-card"},lo={class:"modal-card-head"},po=e("p",{class:"modal-card-title"},"Nueva Venta",-1),mo={class:"modal-card-body"},co={style:{display:"none"}},_o={key:0,class:"column"},uo={class:"field is-horizontal"},Co={class:"field-body"},Po={class:"field has-addons"},So={class:"control"},go={class:"select"},fo=["disabled"],Eo=["value"],Ro={class:"control"},Oo=["placeholder"],Ao={class:"field"},Do={class:"control is-expanded"},Uo=["disabled"],ho={key:0,class:"field"},vo={class:"control is-expanded"},Io={key:1,class:"notification is-danger mt-5"},bo={class:"modal-card-foot"},yo=["disabled"],Mo=N({props:{show:Boolean,client:Object,loading:{type:Boolean,default:!1}},emits:["save","hide"],setup(c,{emit:a}){const n=c,t=V(),o=C(n.show),s=C(n.loading),r=C("ticket"),d=C(!1),f=C(""),P=[{code:1,name:"DNI",length:8},{code:4,name:"CARNET DE EXTRANGERIA",length:12},{code:6,name:"RUC",length:11},{code:7,name:"PASAPORTE",length:12}],m=j(n.client);H(()=>{o.value=n.show}),H(()=>{s.value=n.loading}),H(()=>{m.documentType=1,m.document="",m.name="",m.email="",r.value==="factura"&&(m.documentType=6,m.document="",m.name="")});const _=K(()=>P.find(x=>x.code===m.documentType)),p=async()=>{if(!(_.value.code!==1&&_.value.code!==6)&&(""+m.document).length===_.value.length){const x=await t.dispatch("getInfoDoc",{typeDoc:_.value.code,document:m.document});m.name=x.nombre}};H(()=>{d.value&&setTimeout(()=>{d.value=!1},2500)});const S=()=>{if(r.value!=="ticket"){if(m.document===""||m.name===""){f.value="El documento o el nombre no puede ser vacio",d.value=!0;return}if(r.value==="factura"&&m.email===""){f.value="Se nesesita un email para emitir factura",d.value=!0;return}}a("save",r.value)},v=()=>{m.document=m.document.replace(/\D/,""),m.document.length>_.value.length&&(m.document=m.document.slice(0,_.value.length))};return(x,R)=>o.value?(g(),E("div",ro,[to,e("div",io,[e("header",lo,[po,e("button",{class:"delete","aria-label":"close",onClick:R[0]||(R[0]=D=>a("hide"))})]),e("section",mo,[e("label",{for:"ticket",class:J(["button",{"is-primary":r.value==="ticket"}])},"Ticket",2),e("label",{for:"boleta",class:J(["button",{"is-primary":r.value==="boleta"}])},"Boleta",2),e("label",{for:"factura",class:J(["button",{"is-primary":r.value==="factura"}])},"Factura",2),e("div",co,[U(e("input",{type:"radio","onUpdate:modelValue":R[1]||(R[1]=D=>r.value=D),id:"boleta",value:"boleta"},null,512),[[oe,r.value]]),U(e("input",{type:"radio","onUpdate:modelValue":R[2]||(R[2]=D=>r.value=D),id:"factura",value:"factura"},null,512),[[oe,r.value]]),U(e("input",{type:"radio","onUpdate:modelValue":R[3]||(R[3]=D=>r.value=D),id:"ticket",value:"ticket"},null,512),[[oe,r.value]])]),r.value!=="ticket"?(g(),E("div",_o,[e("div",uo,[e("div",Co,[e("div",Po,[e("p",So,[e("span",go,[U(e("select",{"onUpdate:modelValue":R[4]||(R[4]=D=>i(m).documentType=D),disabled:r.value==="factura"},[(g(),E($,null,X(P,D=>e("option",{key:D.code,value:D.code},y(D.name),9,Eo)),64))],8,fo),[[re,i(m).documentType]])])]),e("p",Ro,[U(e("input",{class:"input is-upper",placeholder:i(_).name,onInput:R[5]||(R[5]=D=>(v(),p())),"onUpdate:modelValue":R[6]||(R[6]=D=>i(m).document=D)},null,40,Oo),[[I,i(m).document]])])])])]),e("div",Ao,[e("p",Do,[U(e("input",{class:"input is-upper",placeholder:"nombre",type:"text","onUpdate:modelValue":R[7]||(R[7]=D=>i(m).name=D),disabled:i(m).documentType===6||i(m).documentType===1},null,8,Uo),[[I,i(m).name]])])]),r.value==="factura"?(g(),E("div",ho,[e("p",vo,[U(e("input",{class:"input",placeholder:"Email",type:"text","onUpdate:modelValue":R[8]||(R[8]=D=>i(m).email=D)},null,512),[[I,i(m).email]])])])):L("",!0)])):L("",!0),d.value?(g(),E("div",Io,[e("button",{onClick:R[9]||(R[9]=D=>d.value=!1),class:"delete"}),Z(" "+y(f.value),1)])):L("",!0)]),e("footer",bo,[e("button",{disabled:s.value,onClick:R[10]||(R[10]=D=>S()),class:"button is-success"},"Imprimir "+y(r.value),9,yo),e("button",{onClick:R[11]||(R[11]=D=>a("hide")),class:"button"},"Cancelar")])])])):L("",!0)}}),To={class:"columns"},Lo={class:"column is-4"},Fo={class:"field"},No={class:"label"},wo={class:"control"},ko=["disabled"],xo={class:"field"},Wo={class:"field"},Go={class:"column is-8"},Vo={class:"table is-bordered is-striped is-fullwidth"},$o=e("thead",null,[e("tr",null,[e("th",null,"Codigo"),e("th",null,"Nombre"),e("th",null,"Precio"),e("th",null,"Cantidad"),e("th",null,"Monto"),e("th")])],-1),jo=e("th",{colspan:"4",style:{"text-align":"right"}},"TOTAL:",-1),Ho=e("th",null,null,-1),Bo=e("div",null,null,-1),Ko=["disabled"],Xo={key:0,class:"notification is-danger mt-5"},Jo={style:{display:"none"}},qo=["srcdoc"],zo=N({setup(c){const a=V(),n=C(""),t=C(),o=C(!1),s=C([]),r=C(""),d=C(!1),f=C(!1),P=C(!1),m=C(!1),_=C(""),p=j({documentType:1,document:"0",name:"",email:""}),S=K(()=>`
  <html>
  <head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300&display=swap" rel="stylesheet">
   <style>
  pre{
    font-family: 'Roboto Mono', monospace;
    font-weight: bold;
    padding:1rem;
    width:460px
    
  }
  </style></head>
  <body>
 
  <pre >
      ${x.value}
  </pre>
  </body>
  </html>
  `),v=A=>{if(A<=0)return"";let l="";for(let u=0;u<A;u++)l+=" ";return l},x=K(()=>`
            INVERSIONES VILVER E.I.R.L
      Jr. Grau Nro. 1032 Cajamarca-Cajabamba   

    BOLETA DE VENTA ELECTRONICA 0000-0000000

Fecha de emision:2006-04-09
ID Venta: 0000546-5s654-sds645-sds65

DNI Cliente:${p.document}
Nombre Cliente:${p.name}
${r.value}
                 Subtotal:           S/${Math.round((M.value*(100/118)+Number.EPSILON)*10)/10}
                 IGV(18%):           S/${Math.round((M.value*(18/118)+Number.EPSILON)*10)/10}
                 Total:              S/${M.value}
------------------------------------------------  `),R=A=>{let l="";for(let u=0;u<8-A.toString().length;u++)l+="0";return l+A.toString()},D=()=>{p.documentType=1,p.document="0",p.name="",p.email="",s.value=[]},G=(A,l,u,F,T=[])=>{let k=`
    INVERSIONES VILVER E.I.R.L - RUC 20605808931
      Jr. Grau Nro. 1032 Cajamarca-Cajabamba  `;return l==="ticket"?k+=`
              TICKET DE VENTA ELECTRONICO 
      `:k+=`
         ${l.toLocaleUpperCase()} ELECTRONICA ${T.serie}-${R(T.correlative)}
      `,k+=`
Fecha de emision:${l!=="ticket"?T.dateTime:u.dateTime}
ID Venta: 00000${u.id}
  `,l!=="ticket"&&(k+=`
CLIENTE:
Documento: ${F.document}
Nombre: ${F.name}
`),k+=q(s.value),k+=`
                OP.GRAVADAS:        S/ ${Math.round((u.total*(100/118)+Number.EPSILON)*10)/10}
                   IGV(18%):        S/ ${Math.round((u.total*(18/118)+Number.EPSILON)*10)/10}
                 DESCUENTOS:        S/ -0.00
              IMPORTE TOTAL:        S/ ${u.total}
------------------------------------------------ 
${A}

************************************************
            !GRACIAS POR SU COMPRA!
`,k},q=A=>{let l="",u="",F=`
------------------------------------------------
`;return F+=`PRODUCTO                 CANT P.UNI   MONTO
`,F+=`------------------------------------------------
`,A.forEach(T=>{l=T.name.slice(0,24)+v(24-T.name.length),l+="  ",l+=""+T.quantity+v(3-(""+T.quantity).length),l+=" S/",l+=""+T.priceSale+v(6-(""+T.priceSale).length),l+=" S/",l+=""+T.mount+v(7-(""+T.mount).length),F+=`${l}
`,T.name.length>24&&(u=T.name.length>48?T.name.slice(24,45)+"...":T.name.slice(24),F+=`${u}
`)}),F+=`------------------------------------------------
`,F},M=K(()=>s.value.reduce((A,l)=>A+l.mount,0)),h=A=>a.state.products.find(({code:u})=>u.toString()===n.value),b=({id:A,code:l,name:u,priceSale:F},T=1)=>{const k={id:A,code:l,name:u,priceSale:F,quantity:T,mount:F*1};if(s.value.every(z=>z.id!==A))s.value.push(k);else{const z=s.value.findIndex(ce=>ce.id===A);s.value[z].quantity+=1,s.value[z].mount=k.priceSale*s.value[z].quantity}s.value.length===0&&s.value.push(k),n.value=""},Q=A=>{const l=s.value.findIndex(u=>u.id===A);s.value.splice(l,1)};Y(async()=>{try{await a.dispatch("fetchProducts");const l=await(await fetch("http://localhost:5050/devices")).json()}catch{m.value=!0,_.value="No se encuentra el controlador de la impresora por favor inicie el controlador y configure la impresora"}});const B=()=>{const A=n.value;setTimeout(()=>{if(n.value===A){const l=h(n.value);l&&b(l),n.value=""}},100)},pe=async A=>{f.value=!0;const l=await a.dispatch("saveSale",{soldProducts:s.value,client:p,typeProof:A});let u="";A!=="ticket"?l.proof.status!=="ACEPTADA"?(_.value=l.proof.description,m.value=!0,setTimeout(()=>{m.value=!1},3e3)):u=G(l.legend,A,l.sale,l.client,l.proof.data):u=G(l.legend,A,l.sale,l.client,[]),console.log(u);try{u=u.normalize("NFKD").replace(/[\u0300-\u036f]/g,""),await a.dispatch("printerTicket",{text:u}),f.value=!1}catch{f.value=!1,_.value="No se ha podido imprimir por que la impresora esta apagada o el controlador esta desactivado",m.value=!0,setTimeout(()=>{m.value=!1},4e3)}finally{D(),d.value=!1}},de=()=>{n.value="",t.value.focus()},me=()=>{if(s.value.some(A=>A.priceSale===0)){_.value="Los precios no pueden ser cero",m.value=!0,setTimeout(()=>{m.value=!1},3e3);return}d.value=!0};return(A,l)=>(g(),E($,null,[O(Mo,{show:d.value,onHide:l[0]||(l[0]=u=>d.value=!1),client:i(p),onSave:l[1]||(l[1]=u=>pe(u)),loading:f.value},null,8,["show","client","loading"]),O(ao,{show:P.value,onHide:l[2]||(l[2]=u=>P.value=!1),onAddProduct:l[3]||(l[3]=u=>b(u))},null,8,["show"]),e("div",To,[e("div",Lo,[U(e("input",{required:"",autocomplete:"off",onInput:l[4]||(l[4]=u=>B()),style:{position:"absolute","pointer-events":"none",opacity:"0"},onClick:l[5]||(l[5]=u=>u.target.blur()),onBlur:l[6]||(l[6]=u=>o.value=!1),onFocus:l[7]||(l[7]=u=>o.value=!0),ref_key:"fieldCode",ref:t,"onUpdate:modelValue":l[8]||(l[8]=u=>n.value=u)},null,544),[[I,n.value]]),e("div",Fo,[e("label",No,"Codigo "+y(": "+n.value),1),e("div",wo,[e("button",{tabindex:"-1",class:"button is-success",disabled:o.value,type:"button",onClick:l[9]||(l[9]=u=>de())},y(o.value?"Escaneando codigos...":"Escanear codigos"),9,ko)])]),e("div",xo,[e("input",{type:"button",class:"button is-info",onClick:l[10]||(l[10]=u=>P.value=!0),value:"Agregar producto manualmente"})]),e("div",Wo,[O(te,{onItemSelected:l[11]||(l[11]=u=>b(u))})])]),e("div",Go,[e("table",Vo,[$o,e("tbody",null,[(g(!0),E($,null,X(s.value,u=>(g(),ee(Gs,{key:u.id,product:u,onQuit:l[12]||(l[12]=F=>Q(F))},null,8,["product"]))),128)),e("tr",null,[jo,e("th",null,"S/. "+y(i(M)),1),Ho])])]),Bo,e("button",{disabled:s.value.length===0,onClick:l[13]||(l[13]=u=>me()),class:"button is-primary"},"Realizar venta",8,Ko),m.value?(g(),E("div",Xo,[e("button",{onClick:l[14]||(l[14]=u=>m.value=!1),class:"delete"}),Z(" "+y(_.value),1)])):L("",!0)]),e("div",Jo,[e("iframe",{style:{width:"550px",height:"900px",padding:"0"},name:"page-printer",srcdoc:i(S)},null,8,qo)])])],64))}}),Yo={class:"columns"},Zo={class:"column"},Qo=["value"],en=N({setup(c){const a=C([]),n=C("");Y(async()=>{const s=await(await fetch("http://localhost:5050/devices")).json();a.value=s,n.value=localStorage.printer});const t=()=>{localStorage.printer=n.value};return(o,s)=>(g(),E("div",Yo,[e("div",Zo,[U(e("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>n.value=r)},[(g(!0),E($,null,X(a.value,r=>(g(),E("option",{key:r.vendor_id,value:r.product_id+"/"+r.vendor_id},y(r.vendor_id)+":"+y(r.product_id)+" "+y(r.name),9,Qo))),128))],512),[[re,n.value]]),e("button",{class:"button is-primary",onClick:s[1]||(s[1]=r=>t())},"Guardar")])]))}}),sn=["onSubmit"],on={class:"field"},nn=e("label",{class:"label"},"Usuario",-1),an={class:"control has-icons-left"},rn={class:"field"},tn=e("label",{class:"label"},"Contrase\xF1a",-1),ln={class:"control has-icons-left"},pn={class:"field"},dn={class:"control is-expanded"},mn=e("button",{class:"button is-primary is-medium input mt-2"},"Iniciar Sesion",-1),cn={key:0,class:"help is-danger"},_n=N({setup(c){const a=V(),n=C(!1),t=Oe(),o=j({userName:"",password:""}),s=async()=>{const r=await a.dispatch("userLogin",{credentials:o});if(n.value=!r.success,r.success){const d=await a.dispatch("fetchProducts");console.log(d),t.replace("products")}console.log(r.message)};return(r,d)=>(g(),E("form",{onSubmit:se(s,["prevent"]),class:"box column is-4 is-offset-4"},[e("div",on,[nn,e("div",an,[U(e("input",{class:"input is-medium",ref:"fieldName",required:"","onUpdate:modelValue":d[0]||(d[0]=f=>i(o).userName=f),placeholder:"Nombre de usuario"},null,512),[[I,i(o).userName]]),O(i(W),{class:"icon is-large is-left"},{default:w(()=>[O(i(Ae))]),_:1})])]),e("div",rn,[tn,e("div",ln,[U(e("input",{class:"input is-medium",required:"","onUpdate:modelValue":d[1]||(d[1]=f=>i(o).password=f),type:"password",placeholder:"************"},null,512),[[I,i(o).password]]),O(i(W),{class:"icon is-large is-left"},{default:w(()=>[O(i(De))]),_:1})])]),e("div",pn,[e("p",dn,[mn,n.value?(g(),E("span",cn,"Error al iniciar session")):L("",!0)])])],40,sn))}}),un=["onSubmit"],Cn={class:"field"},Pn={class:"control"},Sn={key:0,class:"help is-danger"},gn={class:"field"},fn=e("label",{class:"label"},"DNI",-1),En={class:"control"},Rn={class:"field"},On=e("label",{class:"label"},"Nombres y Apellidos",-1),An={class:"control"},Dn={class:"field"},Un=e("label",{class:"label"},"Contrase\xF1a",-1),hn={class:"control"},vn={key:0,class:"help is-danger"},In={class:"field"},bn=e("label",{class:"label"},"Repetir Contrase\xF1a",-1),yn={class:"control"},Mn={key:0,class:"help is-danger"},Tn={class:"field"},Ln=e("label",{class:"label"},"Celular",-1),Fn={class:"control"},Nn={class:"field"},wn=e("label",{class:"label"},"Email",-1),kn={class:"control"},xn=e("button",{class:"button is-primary"},"Registrar usuario",-1),Wn=N({setup(c){const a=C(),n=V(),t=C(!1),o=C([]),s=j({userName:"",dni:"",fullName:"",email:"",password:"",roleId:"1",mobile:""}),r=C(""),d=C(!1),f=()=>{s.password!==r.value?d.value=!0:d.value=!1};Y(async()=>{const m=await n.dispatch("fetchRoles");o.value=m.data});const P=async()=>{if(s.password!==r.value){d.value=!0;return}const m=await n.dispatch("userSignup",{user:s});t.value=m.success,m.success&&(a.value.reset(),alert(`usuario registrado 
 UserName: `+m.data.userName)),console.log(m.message)};return(m,_)=>(g(),E("form",{onSubmit:se(P,["prevent"]),ref_key:"form",ref:a},[e("div",Cn,[e("div",Pn,[t.value?L("",!0):(g(),E("span",Sn,"Ya existe un producto con este codigo"))])]),e("div",gn,[fn,e("div",En,[U(e("input",{class:"input",ref:"fieldName","onUpdate:modelValue":_[0]||(_[0]=p=>i(s).dni=p),type:"number",placeholder:"documento de identidad"},null,512),[[I,i(s).dni]])])]),e("div",Rn,[On,e("div",An,[U(e("input",{class:"input",ref:"fieldName",required:"","onUpdate:modelValue":_[1]||(_[1]=p=>i(s).fullName=p),type:"text",placeholder:"Nombres y apellidos"},null,512),[[I,i(s).fullName]])])]),e("div",Dn,[Un,e("div",hn,[U(e("input",{class:J(["input",{"is-danger":d.value}]),required:"",step:"0.1","onUpdate:modelValue":_[2]||(_[2]=p=>i(s).password=p),type:"password",placeholder:"Contrase\xF1a"},null,2),[[I,i(s).password]]),d.value?(g(),E("span",vn,"Las contrase\xF1as deven ser iguales")):L("",!0)])]),e("div",In,[bn,e("div",yn,[U(e("input",{class:J(["input",{"is-danger":d.value}]),onBlur:_[3]||(_[3]=p=>f()),required:"",step:"0.1","onUpdate:modelValue":_[4]||(_[4]=p=>r.value=p),type:"password",placeholder:"Vuelva a escribir la contrase\xF1a"},null,34),[[I,r.value]]),d.value?(g(),E("span",Mn,"Las contrase\xF1as deven ser iguales")):L("",!0)])]),e("div",Tn,[Ln,e("div",Fn,[U(e("input",{class:"input",step:"0.1","onUpdate:modelValue":_[5]||(_[5]=p=>i(s).mobile=p),type:"number",placeholder:"Numero de celular"},null,512),[[I,i(s).mobile]])])]),e("div",Nn,[wn,e("div",kn,[U(e("input",{class:"input",ref:"fieldName","onUpdate:modelValue":_[6]||(_[6]=p=>i(s).email=p),type:"text",placeholder:"Correo electronico"},null,512),[[I,i(s).email]])])]),xn],40,un))}}),Gn={class:"menu"},Vn=["srcdoc"],$n=N({props:{product:Object,stock:Number},setup(c){const a=c,n=C(),t=C(),o=C("");H(async()=>{Ue("#barcode",a.product.code,{displayValue:!1,height:20,width:1,margin:0}),await s(a.product,a.stock)});const s=async(r,d)=>{const f=t.value.src;let P=`
   <html>
  <head>
  <style>
  *{

  }
  </style>
   </head>
   <body style="width:108mm;padding:0;margin:0">
   <div style="margin:0 2.5mm;padding:0;width:103mm;display:grid;grid-template-columns: repeat(3, 1fr);font-family:arial;font-weight: bold;justify-content:center ;height:21mm ;page-break-after: always">`;for(let m=0;m<d;m++)P+=`<div style="display: flex;flex-direction: column;align-items: center;font-size: 10px;widt:30mm;max-width:30mm;border:1px solid black;padding:2px;text-align:center;height;20mm">
    <span style="margin: 0;padding: 0;z-index: 1;word-wrap:break-word;word-break: break-all;">${r.name}</span>
    <img style="width:29mm" src="${f}"/>
    <span style="margin: 0;padding: 0;z-index: 1">${r.code}</span>
    </div>`;P+=`</div> </body>
  </html>`,o.value=P};return(r,d)=>(g(),E("div",Gn,[e("iframe",{id:"printf",name:"printf",ref_key:"pdf",ref:n,style:{width:"1000px",height:"900px",border:"1x solid red"},srcdoc:o.value},null,8,Vn),e("img",{ref_key:"img",ref:t,id:"barcode",style:{display:"none"}},null,512)]))}}),jn={class:"columns"},Hn={class:"column is-4"},Bn={class:"field"},Kn=e("label",{class:"label"},"Usuario",-1),Xn={class:"control"},Jn=N({setup(c){const a=C({}),n=C(9),t=()=>{const s=window;s.frames.printf.focus(),s.frames.printf.print()},o=s=>{a.value=s,console.log(s.code)};return(s,r)=>(g(),E("div",jn,[e("form",Hn,[e("div",Bn,[Kn,e("div",Xn,[U(e("input",{type:"number",class:"input is-medium",ref:"fieldName",required:"","onUpdate:modelValue":r[0]||(r[0]=d=>n.value=d),placeholder:"Cantidad"},null,512),[[I,n.value,void 0,{number:!0}]])])]),e("button",{type:"button",onClick:r[1]||(r[1]=d=>t()),class:"button is-primary is-medium"},"Imprimir Codigos"),O(te,{onItemSelected:r[2]||(r[2]=d=>o(d))})]),O($n,{class:"column is-8",product:a.value,stock:n.value},null,8,["product","stock"])]))}}),qn=[{path:"/login",name:"login",component:_n},{path:"/sales",name:"sales",component:zo},{path:"/printers",name:"printers",component:en},{path:"/products",name:"products",component:Ts},{path:"/signup",name:"signup",component:Wn},{path:"/barcodes",name:"barcodes",component:Jn}],ie=he({history:ve("vilcherrez"),routes:qn});ie.beforeEach(async(c,a)=>{if(!ne.state.isAuthenticated&&c.name!=="login")return{name:"login"};if(ne.state.isAuthenticated&&c.name==="login")return{name:"sales"}});const le=Ie(xe);le.use(ne).use(ie).mount("#app");le.config.globalProperties.$log=console.log;
